<div class="mt-2 bg-white p-3 rounded shadow">
  <% comments = @comments || [] %>
  <% if comments.any? %>
    <ul class="space-y-2 mb-2">
      <% comments.each do |c| %>
        <li class="border rounded p-2">
          <p class="text-sm text-gray-600">Por: <%= c.user.email %> — <span class="font-semibold"><%= c.role.capitalize %></span> • <%= l(c.created_at, format: :short) %></p>
          <div class="mt-1"><%= c.body.to_s.html_safe %></div>
          <% if c.user == current_user || current_user == @cardapio.business_address.business.user %>
            <%= button_to "Remover", business_business_address_cardapio_item_cardapio_comment_path(@cardapio.business_address.business, @cardapio.business_address, @cardapio, c), method: :delete, data: { confirm: "Confirma remoção?" }, class: "text-red-600 mt-2", form: { data: { turbo_frame: "item_comments_#{params[:item_cardapio_id]}" } } %>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p class="text-gray-500 mb-2">Nenhum comentário neste item.</p>
  <% end %>

  <% if user_signed_in? %>
    <%= form_with model: [@cardapio, ItemCardapioComment.new], url: business_business_address_cardapio_item_cardapio_comments_path(@cardapio.business_address.business, @cardapio.business_address, @cardapio), data: { turbo_frame: "item_comments_#{params[:item_cardapio_id]}" } do |f| %>
      <%= f.hidden_field :item_cardapio_id, value: params[:item_cardapio_id] || f.object.item_cardapio_id %>
      <div class="mb-2">
        <%= f.rich_text_area :body %>
      </div>
      <div>
        <%= f.submit "Adicionar comentário", class: "bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded" %>
      </div>
    <% end %>
  <% else %>
    <p class="text-gray-500">Faça login para comentar este item.</p>
  <% end %>
</div>
