!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CropperViewer={})}(this,(function(e){"use strict";const t="undefined"!=typeof window&&void 0!==window.document,s=t?window:{};t&&s.document.documentElement;const o="cropper",n=`${o}-canvas`,i=`${o}-image`,a=`${o}-selection`,r=`${o}-viewer`,h="load",c="change",l="transform",d=Number.isNaN||s.isNaN;const u=/([a-z\d])([A-Z])/g;function m(e){return String(e).replace(u,"$1-$2").toLowerCase()}const g=/-[A-z\d]/g;function $(e){return e.replace(g,(e=>e.slice(1).toUpperCase()))}const f=/\s\s*/;function p(e,t,s,o){t.trim().split(f).forEach((t=>{e.removeEventListener(t,s,o)}))}function b(e,t,s,o){t.trim().split(f).forEach((t=>{e.addEventListener(t,s,o)}))}const S={bubbles:!0,cancelable:!0,composed:!0};const y=Promise.resolve();const w=/left|top|width|height/i,v="open",C=new WeakMap,I=new WeakMap,E=new Map,k=s.document&&Array.isArray(s.document.adoptedStyleSheets)&&"replaceSync"in s.CSSStyleSheet.prototype;class T extends HTMLElement{get $sharedStyle(){return(this.themeColor?`:host{--theme-color: ${this.themeColor};}`:"")+":host([hidden]){display:none!important}"}constructor(){var e,t;super(),this.shadowRootMode=v,this.slottable=!0;const s=null===(t=null===(e=Object.getPrototypeOf(this))||void 0===e?void 0:e.constructor)||void 0===t?void 0:t.$name;s&&E.set(s,this.tagName.toLowerCase())}static get observedAttributes(){return["shadow-root-mode","slottable","theme-color"]}attributeChangedCallback(e,t,s){if(Object.is(s,t))return;const o=$(e);let n=s;switch(typeof this[o]){case"boolean":n=null!==s&&"false"!==s;break;case"number":n=Number(s)}switch(this[o]=n,e){case"theme-color":{const e=I.get(this),t=this.$sharedStyle;e&&t&&(k?e.replaceSync(t):e.textContent=t);break}}}$propertyChangedCallback(e,t,s){if(!Object.is(s,t))switch(e=m(e),typeof s){case"boolean":!0===s?this.hasAttribute(e)||this.setAttribute(e,""):this.removeAttribute(e);break;case"number":s=d(s)?"":String(s);default:s?this.getAttribute(e)!==s&&this.setAttribute(e,s):this.removeAttribute(e)}}connectedCallback(){Object.getPrototypeOf(this).constructor.observedAttributes.forEach((e=>{const t=$(e);let s=this[t];(function(e){return void 0===e})(s)||this.$propertyChangedCallback(t,void 0,s),Object.defineProperty(this,t,{enumerable:!0,configurable:!0,get:()=>s,set(e){const o=s;s=e,this.$propertyChangedCallback(t,o,e)}})}));const e=this.shadowRoot||this.attachShadow({mode:this.shadowRootMode||v});if(C.set(this,e),I.set(this,this.$addStyles(this.$sharedStyle)),this.$style&&this.$addStyles(this.$style),this.$template){const t=document.createElement("template");t.innerHTML=this.$template,e.appendChild(t.content)}if(this.slottable){const t=document.createElement("slot");e.appendChild(t)}}disconnectedCallback(){I.has(this)&&I.delete(this),C.has(this)&&C.delete(this)}$getTagNameOf(e){var t;return null!==(t=E.get(e))&&void 0!==t?t:e}$setStyles(e){return Object.keys(e).forEach((t=>{let s=e[t];(function(e){return"number"==typeof e&&!d(e)})(s)&&(s=0!==s&&w.test(t)?`${s}px`:String(s)),this.style[t]=s})),this}$getShadowRoot(){return this.shadowRoot||C.get(this)}$addStyles(e){let t;const s=this.$getShadowRoot();return k?(t=new CSSStyleSheet,t.replaceSync(e),s.adoptedStyleSheets=s.adoptedStyleSheets.concat(t)):(t=document.createElement("style"),t.textContent=e,s.appendChild(t)),t}$emit(e,t,s){return function(e,t,s,o){return e.dispatchEvent(new CustomEvent(t,Object.assign(Object.assign(Object.assign({},S),{detail:s}),o)))}(this,e,t,s)}$nextTick(e){return function(e,t){return t?y.then(e?t.bind(e):t):y}(this,e)}static $define(e,o){var n;"object"==typeof(n=e)&&null!==n&&(o=e,e=""),e||(e=this.$name||this.name),e=m(e),t&&s.customElements&&!s.customElements.get(e)&&customElements.define(e,this,o)}}T.$version="2.1.0";const O=new WeakMap,A=new WeakMap,N=new WeakMap,L=new WeakMap,R="both",j="horizontal",x="vertical",M="none";class W extends T{constructor(){super(...arguments),this.$onSelectionChange=null,this.$onSourceImageLoad=null,this.$onSourceImageTransform=null,this.$scale=1,this.$style=":host{display:block;height:100%;overflow:hidden;position:relative;width:100%}",this.resize=x,this.selection="",this.slottable=!1}set $image(e){A.set(this,e)}get $image(){return A.get(this)}set $sourceImage(e){L.set(this,e)}get $sourceImage(){return L.get(this)}set $canvas(e){O.set(this,e)}get $canvas(){return O.get(this)}set $selection(e){N.set(this,e)}get $selection(){return N.get(this)}static get observedAttributes(){return super.observedAttributes.concat(["resize","selection"])}connectedCallback(){var e,t;super.connectedCallback();let s=null;if(s=this.selection?null!==(t=null===(e=function(e){const t=e.getRootNode();switch(t.nodeType){case 1:return t.ownerDocument;case 9:case 11:return t}return null}(this))||void 0===e?void 0:e.querySelector(this.selection))&&void 0!==t?t:null:this.closest(this.$getTagNameOf(a)),"object"==typeof(o=s)&&null!==o&&1===o.nodeType){this.$selection=s,this.$onSelectionChange=this.$handleSelectionChange.bind(this),b(s,c,this.$onSelectionChange);const e=s.closest(this.$getTagNameOf(n));if(e){this.$canvas=e;const t=e.querySelector(this.$getTagNameOf(i));t&&(this.$sourceImage=t,this.$image=t.cloneNode(!0),this.$getShadowRoot().appendChild(this.$image),this.$onSourceImageLoad=this.$handleSourceImageLoad.bind(this),this.$onSourceImageTransform=this.$handleSourceImageTransform.bind(this),b(t.$image,h,this.$onSourceImageLoad),b(t,l,this.$onSourceImageTransform))}this.$render()}var o}disconnectedCallback(){const{$selection:e,$sourceImage:t}=this;e&&this.$onSelectionChange&&(p(e,c,this.$onSelectionChange),this.$onSelectionChange=null),t&&this.$onSourceImageLoad&&(p(t.$image,h,this.$onSourceImageLoad),this.$onSourceImageLoad=null),t&&this.$onSourceImageTransform&&(p(t,l,this.$onSourceImageTransform),this.$onSourceImageTransform=null),super.disconnectedCallback()}$handleSelectionChange(e){this.$render(e.defaultPrevented?this.$selection:e.detail)}$handleSourceImageLoad(){const{$image:e,$sourceImage:t}=this,s=e.getAttribute("src"),o=t.getAttribute("src");o&&o!==s&&(e.setAttribute("src",o),e.$ready((()=>{this.$render()})))}$handleSourceImageTransform(e){this.$render(void 0,e.detail.matrix)}$render(e,t){const{$canvas:s,$selection:o}=this;e||o.hidden||(e=o),(!e||0===e.x&&0===e.y&&0===e.width&&0===e.height)&&(e={x:0,y:0,width:s.offsetWidth,height:s.offsetHeight});const{x:n,y:i,width:a,height:r}=e,h={},{clientWidth:c,clientHeight:l}=this;let d=c,u=l,m=NaN;switch(this.resize){case R:m=1,d=a,u=r,h.width=a,h.height=r;break;case j:m=r>0?l/r:0,d=a*m,h.width=d;break;case x:m=a>0?c/a:0,u=r*m,h.height=u;break;default:c>0?m=a>0?c/a:0:l>0&&(m=r>0?l/r:0)}this.$scale=m,this.$setStyles(h),this.$sourceImage&&setTimeout((()=>{this.$transformImageByOffset(null!=t?t:this.$sourceImage.$getTransform(),-n,-i)}))}$transformImageByOffset(e,t,s){const{$image:o,$scale:n,$sourceImage:i}=this;if(i&&o&&n>=0){const[i,a,r,h,c,l]=e,d=(t*h-r*s)/(i*h-r*a),u=(s*i-a*t)/(i*h-r*a),m=i*d+r*u+c,g=a*d+h*u+l;o.$ready((e=>{this.$setStyles.call(o,{width:e.naturalWidth*n,height:e.naturalHeight*n})})),o.$setTransform(i,a,r,h,m*n,g*n)}}}W.$name=r,W.$version="2.1.0",e.RESIZE_BOTH=R,e.RESIZE_HORIZONTAL=j,e.RESIZE_NONE=M,e.RESIZE_VERTICAL=x,e.default=W,Object.defineProperty(e,"__esModule",{value:!0})}));
